const mainMenuKeyboards = require("../keyboards/mainMenu");
const roomsKeyboards = require("../keyboards/rooms");
const utils = require("../utils");
const states = require("../states");
const services = {
    knowledgeBase: require("../services/knowledgeBase"),
    roomsData: require("../services/roomsData"),
    adminAnswers: require("../services/adminAnswers"),
};

module.exports = function setupMainMenuHandlers(bot, userStates) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
    bot.onText(/\/start/, async (msg) => {
        const chatId = msg.chat.id;
        const userId = msg.from.id;

        userStates.set(userId, states.MAIN_MENU);

        const welcomeMessage = `üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –±–∞–∑—É –æ—Ç–¥—ã—Ö–∞ "–ó–æ–ª–æ—Ç—ã–µ –ü–µ—Å–∫–∏" –æ–∑. –¢—É—Ä–≥–æ—è–∫ üå≤üè°

–ú–µ–Ω—è –∑–æ–≤—É—Ç –Æ–ª–∏—è, —è —Å —Ä–∞–¥–æ—Å—Ç—å—é –ø–æ–º–æ–≥—É –≤–∞–º —Å –ø–æ–¥–±–æ—Ä–æ–º —Ä–∞–∑–º–µ—â–µ–Ω–∏—è.

üìç –ü–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –º—ã –ø—Ä–æ–¥–æ–ª–∂–∏–º, –ø—Ä–æ—á—Ç–∏—Ç–µ –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–Ω–æ–ø–∫–µ!

–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ:`;

        await utils.safeSendMessage(bot, chatId, welcomeMessage, {
            parse_mode: "Markdown",
            ...mainMenuKeyboards.getMainMenuKeyboard(),
        });

        if (utils.isAdmin(userId)) {
            await utils.safeSendMessage(
                bot,
                chatId,
                "üîß –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–∞",
                {
                    parse_mode: "Markdown",
                    reply_markup: {
                        inline_keyboard: [
                            [
                                {
                                    text: "‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å",
                                    callback_data: "admin_panel",
                                },
                            ],
                        ],
                    },
                },
            );
        }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã –º–µ–Ω—é
    bot.onText(/–º–µ–Ω—é|menu/i, async (msg) => {
        const chatId = msg.chat.id;
        const userId = msg.from.id;

        userStates.set(userId, states.MAIN_MENU);
        await utils.safeSendMessage(
            bot,
            chatId,
            "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:",
            mainMenuKeyboards.getMainMenuKeyboard(),
        );
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∑–∞–ø—Ä–æ—Å–æ–≤ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
    bot.on("callback_query", async (callbackQuery) => {
        const msg = callbackQuery.message;
        const chatId = msg.chat.id;
        const userId = callbackQuery.from.id;
        const data = callbackQuery.data;

        try {
            try {
                await bot.answerCallbackQuery(callbackQuery.id);
            } catch (error) {
                console.error(
                    "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –Ω–∞ callback query:",
                    error.message,
                );
            }

            switch (data) {
                case "important_info":
                    await handleImportantInfo(bot, chatId);
                    break;

                case "rooms":
                    const roomsData = services.roomsData.getRoomsData();
                    console.log(
                        "–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:",
                        roomsData.length,
                    );
                    console.log(
                        "–ü–µ—Ä–≤—ã–π –Ω–æ–º–µ—Ä:",
                        JSON.stringify(roomsData[0], null, 2),
                    );
                    await utils.safeSendMessage(
                        bot,
                        chatId,
                        "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–µ—Ä:",
                        roomsKeyboards.getRoomsKeyboard(roomsData),
                    );
                    break;

                case "entertainment":
                    await handleEntertainment(bot, chatId);
                    break;

                case "facilities":
                    await handleFacilities(bot, chatId);
                    break;

                case "directions":
                    await handleDirections(bot, chatId);
                    break;

                case "booking":
                    userStates.set(userId, states.BOOKING_PROCESS);
                    await utils.safeSendMessage(
                        bot,
                        chatId,
                        "–ë—ã–ª–∏ –ª–∏ –≤—ã —É –Ω–∞—Å?",
                        mainMenuKeyboards.getBookingKeyboard(),
                    );
                    break;

                case "back_to_menu":
                    userStates.set(userId, states.MAIN_MENU);
                    await utils.safeSendMessage(
                        bot,
                        chatId,
                        "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –º–µ–Ω—é –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ:",
                        mainMenuKeyboards.getMainMenuKeyboard(),
                    );
                    break;

                case "booking_yes":
                    await handleBookingYes(bot, chatId);
                    break;

                case "booking_no":
                    await handleBookingNo(bot, chatId);
                    break;

                default:
                    if (data.startsWith("room_")) {
                        await handleRoomDetails(bot, chatId, data);
                    }
                    break;
            }
        } catch (error) {
            console.error(
                "–û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ callback query:",
                error.message,
            );
            try {
                await bot.answerCallbackQuery(callbackQuery.id);
            } catch (answerError) {
                console.error(
                    "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ callback query:",
                    answerError.message,
                );
            }
        }
    });

    async function handleImportantInfo(bot, chatId) {
        try {
            // –°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç
            await bot.sendDocument(
                chatId,
                "./–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –∏ –æ—Ç–¥—ã—Ö–∞.docx.pdf",
                {
                    caption: "–ü—Ä–æ—à—É –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è",
                },
            );

            // –ü–æ—Ç–æ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
            await bot.sendPhoto(
                chatId,
                "https://optim.tildacdn.com/tild3931-6461-4564-a236-353432383431/-/format/webp/_.png.webp",
                {
                    caption: `üìå –ù–∞—à–∞ –±–∞–∑–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –Ω–∞ –±–µ—Ä–µ–≥—É –æ–∑–µ—Ä–∞ –≤ –∑–∞–ø–æ–≤–µ–¥–Ω–æ–π –∑–æ–Ω–µ.
    üíß –í —Ü–µ–ª—è—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫–æ–ª–æ–≥–∏–∏:
    ‚Ä¢ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤–æ–¥–æ–ø—Ä–æ–≤–æ–¥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
    ‚Ä¢ –î—É—à–∞ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –±–∞–Ω–∏ –Ω–∞ –¥—Ä–æ–≤–∞—Ö (–∫–∞–∫ –¥–ª—è –ø–æ–º—ã–≤–∫–∏, —Ç–∞–∫ –∏ –¥–ª—è –æ—Ç–¥—ã—Ö–∞)
    ‚Ä¢ –£–¥–æ–±—Å—Ç–≤–∞ –Ω–∞ —É–ª–∏—Ü–µ
    üßª –ë–æ–ª—å—à–æ–π –¥–∞—á–Ω—ã–π —Ç—É–∞–ª–µ—Ç –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏
    
    –ï—Å–ª–∏ —Ç–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –≤–∞—Å —É—Å—Ç—Ä–∞–∏–≤–∞—é—Ç, –¥–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–∫–∞–∂—É –ø–æ–¥—Ä–æ–±–Ω–µ–µ üòä
    
    –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –º–µ–Ω—é –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ:`,
                    parse_mode: "Markdown",
                    ...mainMenuKeyboards.getBackToMenuKeyboard(),
                },
            );
        } catch (error) {
            console.error(
                "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –º–µ–¥–∏–∞ –≤ handleImportantInfo:",
                error,
            );
            // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ —Å –º–µ–¥–∏–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
            await utils.safeSendMessage(
                bot,
                chatId,
                `üìå –ù–∞—à–∞ –±–∞–∑–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –Ω–∞ –±–µ—Ä–µ–≥—É –æ–∑–µ—Ä–∞ –≤ –∑–∞–ø–æ–≤–µ–¥–Ω–æ–π –∑–æ–Ω–µ.
    üíß –í —Ü–µ–ª—è—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫–æ–ª–æ–≥–∏–∏:
    ‚Ä¢ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤–æ–¥–æ–ø—Ä–æ–≤–æ–¥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
    ‚Ä¢ –î—É—à–∞ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –±–∞–Ω–∏ –Ω–∞ –¥—Ä–æ–≤–∞—Ö (–∫–∞–∫ –¥–ª—è –ø–æ–º—ã–≤–∫–∏, —Ç–∞–∫ –∏ –¥–ª—è –æ—Ç–¥—ã—Ö–∞)
    ‚Ä¢ –£–¥–æ–±—Å—Ç–≤–∞ –Ω–∞ —É–ª–∏—Ü–µ
    üßª –ë–æ–ª—å—à–æ–π –¥–∞—á–Ω—ã–π —Ç—É–∞–ª–µ—Ç –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏
    üë∂ –î–µ—Ç–∏ –¥–æ 5 –ª–µ—Ç ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ (–µ—Å–ª–∏ –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–ø–∞–ª—å–Ω–æ–≥–æ –º–µ—Å—Ç–∞)
    –ï—Å–ª–∏ —Ç–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –≤–∞—Å —É—Å—Ç—Ä–∞–∏–≤–∞—é—Ç, –¥–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–∫–∞–∂—É –ø–æ–¥—Ä–æ–±–Ω–µ–µ üòä
    –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –º–µ–Ω—é –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ:
    –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.`,
                {
                    parse_mode: "Markdown",
                    ...mainMenuKeyboards.getBackToMenuKeyboard(),
                },
            );
        }
    }

    async function handleEntertainment(bot, chatId) {
        // –ú–∞—Å—Å–∏–≤ —Å URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
        const photos = [
            "https://optim.tildacdn.com/tild6233-3239-4366-b961-353031343162/-/format/webp/IMG_6004.JPG.webp",
            "https://optim.tildacdn.com/tild6166-3263-4564-a437-663266376430/-/format/webp/attachment_2.jpeg.webp",
            "https://optim.tildacdn.com/tild6536-3163-4632-a664-373831643865/-/format/webp/DSC04403.JPG.webp",
            "https://optim.tildacdn.com/tild3665-3063-4737-b034-346261663034/-/contain/673x897/center/center/-/format/webp/IMG_2931.jpg.webp",
            "https://optim.tildacdn.com/tild6263-6139-4635-b462-346138396261/-/format/webp/IMG_6005.JPG.webp",
            "https://optim.tildacdn.com/tild3230-3630-4463-b633-373131393963/-/format/webp/photo.jpg.webp",
        ];

        const message = `üèñ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è:
    1. –ö—É–ø–∞–Ω–∏–µ –≤ –æ–∑–µ—Ä–µ
    2. –†—É—Å—Å–∫–∞—è –±–∞–Ω—è —Å –ø–∞—Ä–µ–Ω–∏–µ–º ‚ùÑÔ∏è:
        - –ë–∞–Ω—è —Ä—É—Å—Å–∫–∞—è –Ω–∞ –¥—Ä–æ–≤–∞—Ö. –ë–æ–ª—å—à–∞—è, –æ—Ç 8 –¥–æ 30 —á–µ–ª–æ–≤–µ–∫. –í–º–µ—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã—Å–æ–∫–∞—è. –ú–∞–Ω–≥–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ –∏ –º–∞–Ω–≥–∞–ª –ø–µ—Ä–µ–¥ –±–∞–Ω–µ–π  –ë–æ–ª—å—à–∞—è –ø–∞—Ä–∏–ª–∫–∞, –º–æ–µ—á–Ω–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ, –±–æ–ª—å—à–æ–π –ø—Ä–µ–¥–±–∞–Ω–Ω–∏–∫ —Å –±–æ–ª—å—à–∏–º —Å—Ç–æ–ª–æ–º –∏ —Å–∫–∞–º–µ–π–∫–∞–º–∏ - –°—Ç–æ–∏–º–æ—Å—Ç—å 2500 —á–∞—Å, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç —Ç—Ä–µ—Ö —á–∞—Å–æ–≤.
        - –ë–∞–Ω—è —Ä—É—Å—Å–∫–∞—è –Ω–∞ –¥—Ä–æ–≤–∞—Ö. –ú–∞–ª–∞—è - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤–º–µ—Å—Ç–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 6 —á–µ–ª–æ–≤–µ–∫. –°—Ç–æ–∏–º–æ—Å—Ç—å 2000 —á–∞—Å –æ—Ç 1.5 —á–∞—Å–æ–≤. 
      üìç–ü–æ—Å–µ—â–µ–Ω–∏–µ –ø–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –±—Ä–æ–Ω–∏, –∑–∞ —á–µ—Ç—ã—Ä–µ —á–∞—Å–∞ –±–æ–ª—å—à—É—é –∏ –∑–∞ –¥–≤–∞ –º–∞–ª—É—é. 
      üìç–ë–∞–Ω–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ 25 –º–µ—Ç—Ä–∞—Ö –æ—Ç –æ–∑–µ—Ä–∞. 
    3. –ü—Ä–æ–∫–∞—Ç:
        - –°–∞–ø–±–æ—Ä–¥ ‚Äî 1200‚ÇΩ/—á–∞—Å, 3000‚ÇΩ –Ω–∞ 3 —á–∞—Å–∞
        - –ë–∞–π–¥–∞—Ä–∫–∞ (3 —á–µ–ª.) - 1500‚ÇΩ/—á–∞—Å, 3500‚ÇΩ –Ω–∞ 3 —á–∞—Å–∞
        - –õ–æ–¥–∫–∞ –¥–≤—É—Ö–º–µ—Å—Ç–Ω–∞—è –Ω–∞–¥—É–≤–Ω–∞—è - 1500‚ÇΩ/—á–∞—Å, 3500‚ÇΩ –Ω–∞ 3 —á–∞—Å–∞
        - –õ–æ–¥–∫–∞ –Ω–∞–¥—É–≤–Ω–∞—è —á–µ—Ç—ã—Ä–µ—Ö–º–µ—Å—Ç–Ω–∞—è - 1500‚ÇΩ/—á–∞—Å, 3500‚ÇΩ –Ω–∞ 3 —á–∞—Å–∞
      üìç –°–ø–∞—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∂–∏–ª–µ—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å!
      üìç –ü–ª–∞–≤—Å—Ä–µ–¥—Å—Ç–≤–∞ –≤—ã–¥–∞—é—Ç—Å—è –ø–æ–¥ –æ–±–µ—Å–ø–µ—á–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ª–æ–≥!
    4. –í–æ–ª–µ–π–±–æ–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥–∫–∞ 
    5.	–ô–æ–≥–∞ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–æ–∑–¥—É—Ö–µ, —Å –ø–æ—é—â–∏–º–∏ —á–∞—à–∞–º–∏ –¥–ª—è –≥–æ—Å—Ç–µ–π –∫–∞–∂–¥—É—é —Å—Ä–µ–¥—É, —Å—É–±–±–æ—Ç—É –∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 9.00 –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ —Ö–æ—Ä–æ—à–µ–π –ø–æ–≥–æ–¥—ã.
    6. üçñ *–ê—Ä–µ–Ω–¥–∞ –º–∞–Ω–≥–∞–ª—å–Ω–æ–π –∑–æ–Ω—ã*
        –£ –Ω–∞—Å –µ—Å—Ç—å –º–∞–Ω–≥–∞–ª—å–Ω—ã–µ –∑–æ–Ω—ã –ø—Ä—è–º–æ –Ω–∞ –±–µ—Ä–µ–≥—É ‚Äî –±–æ–ª—å—à–∏–µ —Å—Ç–æ–ª—ã —Å–æ —Å–∫–∞–º–µ–π–∫–∞–º–∏ –∏ –º–∞–Ω–≥–∞–ª–æ–º. –ó–æ–Ω—ã –æ—Ç–∫—Ä—ã—Ç—ã–µ (–Ω–µ –∫—Ä—ã—Ç—ã–µ), –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ø–∏–∫–Ω–∏–∫–∞ —É –≤–æ–¥—ã.
        üí∞ *–°—Ç–æ–∏–º–æ—Å—Ç—å –∞—Ä–µ–Ω–¥—ã:*  
        ‚Äî *–í—ã—Ö–æ–¥–Ω—ã–µ:* 2500 ‚ÇΩ –∑–∞ 3 —á–∞—Å–∞  
        ‚Äî *–ü—Ä–æ–¥–ª–µ–Ω–∏–µ:* 500 ‚ÇΩ –∑–∞ –∫–∞–∂–¥—ã–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —á–∞—Å  
        ‚Äî *–ë—É–¥–Ω–∏–µ –¥–Ω–∏:* 2500 ‚ÇΩ –∑–∞ –≤–µ—Å—å –¥–µ–Ω—å
        üöó *–ü–∞—Ä–∫–æ–≤–∫–∞ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ* ‚Äî 500 ‚ÇΩ –≤ —Å—É—Ç–∫–∏.
        –ü—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–æ–º–µ—Ä–∞ –º–∞–Ω–≥–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ –≤—Ö–æ–¥–∏—Ç –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞.
        –ú–∞–Ω–≥–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞ ‚Äî –æ—Ç–ª–∏—á–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –æ—Ç–¥—ã—Ö–∞ —Å –¥—Ä—É–∑—å—è–º–∏ –∏ —Å–µ–º—å—ë–π —É —Å–∞–º–æ–≥–æ –±–µ—Ä–µ–≥–∞ –æ–∑–µ—Ä–∞! üåÖ
        –û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã? –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –º–µ–Ω—é –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ:`;

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø—É —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ –±–µ–∑ —Ç–µ–∫—Å—Ç–∞
        try {
            await bot.sendMediaGroup(
                chatId,
                photos.map((photo) => ({
                    type: "photo",
                    media: photo,
                })),
            );

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
            await utils.safeSendMessage(bot, chatId, message, {
                parse_mode: "Markdown",
                ...mainMenuKeyboards.getBackToMenuKeyboard(),
            });
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø—ã:", error);
            // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø—É, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—ã—á–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            await utils.safeSendMessage(bot, chatId, message, {
                parse_mode: "Markdown",
                ...mainMenuKeyboards.getBackToMenuKeyboard(),
            });
        }
    }

    async function handleFacilities(bot, chatId) {
        await utils.safeSendMessage(
            bot,
            chatId,
            `üçΩÔ∏è –£–¥–æ–±—Å—Ç–≤–∞:
‚Ä¢ –û–±—â–∞—è –∫—É—Ö–Ω—è —Å –≥–∞–∑–æ–≤—ã–º–∏ –ø–ª–∏—Ç–∞–º–∏
‚Ä¢ –ü–∞—Ä–∫–æ–≤–∫–∞:
  - –õ–µ–≥–∫–æ–≤–æ–π –∞–≤—Ç–æ ‚Äî 500‚ÇΩ/—Å—É—Ç–∫–∏
  - –ì–∞–∑–µ–ª—å ‚Äî 1000‚ÇΩ/—Å—É—Ç–∫–∏
‚Ä¢ –ß–∏—Å—Ç–µ–π—à–∞—è —Ä–æ–¥–Ω–∏–∫–æ–≤–∞—è –≤–æ–¥–∞ –∏–∑ –æ–∑–µ—Ä–∞
‚Ä¢ –ó–∞–ø–∞—Å –ø–∏—Ç—å–µ–≤–æ–π –≤–æ–¥—ã, —Ä–µ—à—ë—Ç–∫–∏ –∏ —É–≥–ª–∏ ‚Äî –±–µ—Ä–∏—Ç–µ —Å —Å–æ–±–æ–π

–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã? –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –º–µ–Ω—é –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ:`,
            {
                parse_mode: "Markdown",
                ...mainMenuKeyboards.getBackToMenuKeyboard(),
            },
        );
    }

    async function handleDirections(bot, chatId) {
        await utils.safeSendMessage(
            bot,
            chatId,
            `üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 55.1881079369311, 60.05969764417703.
[https://yandex.ru/maps/?ll=60.061851%2C55.187183&mode=routes&rtext=~55.187969%2C60.059069&rtt=auto&ruri=~ymapsbm1%3A%2F%2Forg%3Foid%3D109014041624&source=serp_navig&z=15.3]

üöô –í–æ–∑–º–æ–∂–µ–Ω –∑–∞–µ–∑–¥ –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ, –ø–∞—Ä–∫–æ–≤–∫–∞ –ø–ª–∞—Ç–Ω–∞—è.

–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã? –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –º–µ–Ω—é –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ:`,
            {
                parse_mode: "Markdown",
                ...mainMenuKeyboards.getBackToMenuKeyboard(),
            },
        );
    }

    async function handleBookingYes(bot, chatId) {
        await utils.safeSendMessage(
            bot,
            chatId,
            `üõèÔ∏è –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:
[–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä](https://your-booking-link.com)

–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –ø—Ä—è–º–æ –≤ —ç—Ç–æ–º —á–∞—Ç–µ!`,
            {
                parse_mode: "Markdown",
                ...mainMenuKeyboards.getBackToMenuKeyboard(),
            },
        );
    }

    async function handleBookingNo(bot, chatId) {
        await utils.safeSendMessage(
            bot,
            chatId,
            `üìå –ù–∞—à–∞ –±–∞–∑–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –Ω–∞ –±–µ—Ä–µ–≥—É –æ–∑–µ—Ä–∞ –≤ –∑–∞–ø–æ–≤–µ–¥–Ω–æ–π –∑–æ–Ω–µ.

üíß –í —Ü–µ–ª—è—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–∫–æ–ª–æ–≥–∏–∏:
‚Ä¢ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –≤–æ–¥–æ–ø—Ä–æ–≤–æ–¥ –æ—Ç—Å—É—Ç}ÔøΩ—Ç–≤—É—é—Ç
‚Ä¢ –î—É—à–∞ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ —Ä—É—Å—Å–∫–∏–µ –±–∞–Ω–∏ –Ω–∞ –¥—Ä–æ–≤–∞—Ö (–∫–∞–∫ –¥–ª—è –ø–æ–º—ã–≤–∫–∏, —Ç–∞–∫ –∏ –¥–ª—è –æ—Ç–¥—ã—Ö–∞)
‚Ä¢ –£–¥–æ–±—Å—Ç–≤–∞ –Ω–∞ —É–ª–∏—Ü–µ

üßª –ë–æ–ª—å—à–æ–π –¥–∞—á–Ω—ã–π —Ç—É–∞–ª–µ—Ç –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏
üë∂ –î–µ—Ç–∏ –¥–æ 5 –ª–µ—Ç ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ (–µ—Å–ª–∏ –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–ø–∞–ª—å–Ω–æ–≥–æ –º–µ—Å—Ç–∞)

–ï—Å–ª–∏ —Ç–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –≤–∞—Å —É—Å—Ç—Ä–∞–∏–≤–∞—é—Ç, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é:
[–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä](https://your-booking-link.com)

–ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É –ø—Ä—è–º–æ –≤ —ç—Ç–æ–º —á–∞—Ç–µ –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞!

–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã? –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –º–µ–Ω—é –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ:`,
            {
                parse_mode: "Markdown",
                ...mainMenuKeyboards.getBackToMenuKeyboard(),
            },
        );
    }

    async function handleRoomDetails(bot, chatId, data) {
        const roomIndex = parseInt(data.split("_")[1]);
        const roomsData = services.roomsData.getRoomsData();
        const room = roomsData[roomIndex];
        if (room) {
            console.log(`üì∏ –ü–æ–∫–∞–∑ –Ω–æ–º–µ—Ä–∞ ${room.ID || roomIndex}:`, room);
            // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞
            let roomInfo = `üè† ${room.–ù–∞–∑–≤–∞–Ω–∏–µ || "–ù–æ–º–µ—Ä –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}\n\n`;
            if (room.–û–ø–∏—Å–∞–Ω–∏–µ) roomInfo += `üìù ${room.–û–ø–∏—Å–∞–Ω–∏–µ}\n\n`;
            if (room.–¢–∏–ø) roomInfo += `üè∑Ô∏è –û–±—ä–µ–∫—Ç –∞—Ä–µ–Ω–¥—ã: ${room.–¢–∏–ø}\n`;
            if (room.–ö–æ–º–Ω–∞—Ç) roomInfo += `üè† –ö–æ–º–Ω–∞—Ç: ${room.–ö–æ–º–Ω–∞—Ç}\n`;
            if (room.–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
                roomInfo += `üë• –í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ${room.–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å} —á–µ–ª. –≤ –∫–æ–º–Ω–∞—Ç–µ\n`;
            if (room.–¶–µ–Ω–∞) roomInfo += `üí∞ –¶–µ–Ω–∞: –æ—Ç ${room.–¶–µ–Ω–∞}‚ÇΩ\n`;
            if (room.–£–¥–æ–±—Å—Ç–≤–∞) roomInfo += `üõèÔ∏è –£–¥–æ–±—Å—Ç–≤–∞: ${room.–£–¥–æ–±—Å—Ç–≤–∞}\n`;
            if (room.–í—Ö–æ–¥–∏—Ç)
                roomInfo += `‚ÑπÔ∏è –í —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –≤—Ö–æ–¥–∏—Ç: ${room.–í—Ö–æ–¥–∏—Ç}\n`;

            // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—Ä–∞–∑—É –æ –≤–æ–ø—Ä–æ—Å–∞—Ö
            roomInfo += `\n‚ùì –û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã? –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏–∑ –º–µ–Ω—é –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç–µ:`;

            // –ü–æ–ª—É—á–∞–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
            let photos = room.photos || [];
            if (photos.length === 0) {
                // –ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ ID –Ω–æ–º–µ—Ä–∞
                const roomPhotos = services.roomsData.getRoomPhotos(room.ID);
                if (roomPhotos && roomPhotos.length > 0) {
                    photos = roomPhotos;
                }
            }

            if (photos && photos.length > 0) {
                console.log(
                    `‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ${photos.length} —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è –Ω–æ–º–µ—Ä–∞ ${room.ID || roomIndex}`,
                );

                try {
                    if (photos.length === 1) {
                        // –ï—Å–ª–∏ –æ–¥–Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é
                        await bot.sendPhoto(chatId, photos[0], {
                            caption: roomInfo,
                            parse_mode: "Markdown",
                            reply_markup:
                                roomsKeyboards.getRoomDetailsKeyboard()
                                    .reply_markup,
                        });
                    } else {
                        // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º media group
                        const mediaGroup = photos.map((photo, index) => ({
                            type: "photo",
                            media: photo,
                            // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫ –ø–µ—Ä–≤–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                            caption: index === 0 ? roomInfo : undefined,
                            parse_mode: index === 0 ? "Markdown" : undefined,
                        }));

                        await bot.sendMediaGroup(chatId, mediaGroup);

                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ –º–µ–¥–∏–∞–≥—Ä—É–ø–ø—ã
                        await utils.safeSendMessage(
                            bot,
                            chatId,
                            "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
                            {
                                ...roomsKeyboards.getRoomDetailsKeyboard(),
                            },
                        );
                    }
                } catch (error) {
                    console.error(
                        `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ–¥–∏–∞–≥—Ä—É–ø–ø—ã:`,
                        error.message,
                    );

                    // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–µ–¥–∏–∞–≥—Ä—É–ø–ø—É, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ —Å—Ç–∞—Ä–æ–º—É –º–µ—Ç–æ–¥—É
                    for (let i = 0; i < photos.length; i++) {
                        const photoUrl = photos[i];
                        try {
                            console.log(
                                `üì∑ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ ${i + 1}/${photos.length}: ${photoUrl}`,
                            );

                            if (i === 0) {
                                // –ö –ø–µ—Ä–≤–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
                                await bot.sendPhoto(chatId, photoUrl, {
                                    caption: roomInfo,
                                    parse_mode: "Markdown",
                                });
                            } else {
                                await bot.sendPhoto(chatId, photoUrl);
                            }

                            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
                            if (i < photos.length - 1) {
                                await new Promise((resolve) =>
                                    setTimeout(resolve, 500),
                                );
                            }
                        } catch (photoError) {
                            console.error(
                                `‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ ${photoUrl}:`,
                                photoError.message,
                            );
                            await utils.safeSendMessage(
                                bot,
                                chatId,
                                `üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è: ${photoUrl}`,
                            );
                        }
                    }

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
                    await utils.safeSendMessage(
                        bot,
                        chatId,
                        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
                        {
                            ...roomsKeyboards.getRoomDetailsKeyboard(),
                        },
                    );
                }
            } else {
                console.log(
                    `‚ö†Ô∏è –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –Ω–æ–º–µ—Ä–∞ ${room.ID || roomIndex} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`,
                );

                // –ï—Å–ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ
                await utils.safeSendMessage(bot, chatId, roomInfo, {
                    parse_mode: "Markdown",
                    ...roomsKeyboards.getRoomDetailsKeyboard(),
                });
            }
        } else {
            console.log(`‚ùå –ù–æ–º–µ—Ä —Å –∏–Ω–¥–µ–∫—Å–æ–º ${roomIndex} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
            await utils.safeSendMessage(
                bot,
                chatId,
                "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–º–µ—Ä–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
                {
                    reply_markup: {
                        inline_keyboard: [
                            [
                                {
                                    text: "üîô –ö —Å–ø–∏—Å–∫—É –Ω–æ–º–µ—Ä–æ–≤",
                                    callback_data: "rooms",
                                },
                            ],
                        ],
                    },
                },
            );
        }
    }
};
